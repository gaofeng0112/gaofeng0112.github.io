(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{276:function(t,s,a){"use strict";a.r(s);var n=a(38),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"常见的dome优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见的dome优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 常见的Dome优化")]),t._v(" "),a("p",[t._v("随着用户体验的日益重视，前端性能对用户体验的影响备受关注，但由于引起性能问题的 原因相对复杂，我们很难但从某一方面或某几个方面来全面解决它，接下来用一系列文章 来深层次探讨与梳理有关 Javascript 性能的方方面面，以填补并夯实大家的知识结构。")]),t._v(" "),a("p",[t._v("接下来我们来聊一聊关于 DOM 操作相关的性能优化。前端工程师被退出到现在，一直说的 的一句话:操作 DOM 的成本很高，不要轻易去操作 DOM。尤其是 React、vue 等 MV*框架的 出现，数据驱动视图的模式越发深入人心，jQuery 时代提供的强大便利地操作 DOM 的 API 在前端工程里用的越来越少。刨根问底，这里说的成本，到底高在哪儿呢?")]),t._v(" "),a("h2",{attrs:{id:"dom-操作成本到底高在哪儿"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom-操作成本到底高在哪儿","aria-hidden":"true"}},[t._v("#")]),t._v(" DOM 操作成本到底高在哪儿?")]),t._v(" "),a("p",[t._v("什么是 DOM?可能很多人第一反应就是 div、p、span 等 html 标签(至少我是)，但要知 道，DOM 是 Model，是 Object Model，对象模型，是为 HTML(and XML)提供的 API。 HTML(Hyper Text Markup Language)是一种标记语言，HTML 在 DOM 的模型标准中被视为 对象，DOM 只提供编程接口，却无法实际操作 HTML 里面的内容。但在浏览器端，前端们 可以用脚本语言(JavaScript)通过 DOM 去操作 HTML 内容。")]),t._v(" "),a("p",[t._v("实质上还存在 CSSOM:CSS Object Model，浏览器将 CSS 代码解析成树形的数据结构，与 DOM 是两个独立的数据结构。")]),t._v(" "),a("p",[t._v("接下来说一说浏览器渲染过程。")]),t._v(" "),a("p",[t._v("讨论 DOM 操作成本，肯定要先了解该成本的来源，那么就离不开浏览器渲染。")]),t._v(" "),a("ol",[a("li",[t._v("解析 HTML，构建 DOM 树(这里遇到外链，此时会发起请求)")]),t._v(" "),a("li",[t._v("解析 CSS，生成 CSS 规则树")]),t._v(" "),a("li",[t._v("合并 DOM 树和 CSS 规则，生成 render 树")]),t._v(" "),a("li",[t._v("布局 render 树(Layout/reflow)，负责各元素尺寸、位置的计算 5. 绘制 render 树(paint)，绘制页面像素信息")]),t._v(" "),a("li",[t._v("浏览器会将各层的信息发送给 GPU，GPU 将各层合成(composite)，显示在屏幕上")])]),t._v(" "),a("p",[a("strong",[t._v("1.构建DOM树")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<html>\n  <head>\n    <meta name="viewport" content="width=device-width,initial-scale=1">\n    <link href="style.css" rel="stylesheet">\n    <title>Critical Path</title>\n  </head>\n  <body>\n    <p>Hello <span>web performance</span> students!</p>\n    <div><img src="awesome-photo.jpg"></div>\n  </body>\n</html>\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("无论是 DOM 还是 CSSOM，都是要经过 Bytes → characters → tokens → nodes → object model 这个过程。")]),t._v(" "),a("p",[t._v("DOM 树构建过程:当前节点的所有子节点都构建好后才会去构建当前节点的下一个兄弟节 点。属于深度优先遍历过程。")]),t._v(" "),a("p",[a("strong",[t._v("2.构建CSSOM")]),a("br"),t._v("\n上述也提到了 CSSOM 的构建过程，也是树的结构，在最终计算各个节点的样式时，浏览器 都会先从该节点的普遍属性(比如 body 里设置的全局样式)开始，再去应用该节点的具 体属性。还有要注意的是，每个浏览器都有自己默认的样式表，因此很多时候这棵 CSSOM 树只是对这张默认样式表的部分替换。")]),t._v(" "),a("p",[a("strong",[t._v("3.生成render树")]),a("br"),t._v("\n简单描述这个过程:\nDOM 树从根节点开始遍历可见节点，这里之所以强调了“可见”，是因为如果遇到设置了 类似 display: none;的不可见节点，在 render 过程中是会被跳过的(但 visibility: hidden; opacity: 0 这种仍旧占据空间的节点不会被跳过 render)，保存各个节点的样 式信息及其余节点的从属关系。")]),t._v(" "),a("p",[a("strong",[t._v("4.layout布局")]),t._v("\n有了各个节点的样式信息和属性，但不知道各个节点的确切位置和大小，所以要通过布局\n将样式信息和属性转换为实际可视窗口的相对大小和位置。")]),t._v(" "),a("p",[a("strong",[t._v("5.Paint绘制")]),t._v("\n万事俱备，最后只要将确定好位置大小的各节点，通过 GPU 渲染到屏幕的实际像素。")]),t._v(" "),a("p",[a("strong",[t._v("Tips")])]),t._v(" "),a("ul",[a("li",[t._v("在上述渲染过程中，前 3 点可能要多次执行，比如 js 脚本去操作 dom、更改 css 样式时，浏览器又要重新构建 DOM、CSSOM 树，重新 render，重新 layout、 paint;")]),t._v(" "),a("li",[t._v("Layout 在 Paint 之前，因此每次 Layout 重新布局(reflow 回流)后都要重新出 发 Paint 渲染，这时又要去消耗 GPU;")]),t._v(" "),a("li",[t._v("Paint 不一定会触发 Layout，比如改个颜色改个背景;(repaint 重绘)")]),t._v(" "),a("li",[t._v("图片下载完也会重新出发 Layout 和 Paint;")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 10")]),t._v("\na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 10")]),t._v("\na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 10")]),t._v("\na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 10")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])])},[],!1,null,null,null);s.default=e.exports}}]);